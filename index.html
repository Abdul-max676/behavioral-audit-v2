<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Behavioral Audit</title>
</head>
<body>

  <h1>Behavioral Audit</h1>

  <input id="habitInput" placeholder="Enter habit">
  <button onclick="addHabit()">Add</button>

  <ul id="habitList"></ul>

  <script>
  let habits = JSON.parse(localStorage.getItem("habits")) || [];

  function saveHabits() {
    localStorage.setItem("habits", JSON.stringify(habits));
  }

  function todayString() {
    return new Date().toISOString().split("T")[0];
  }

  function renderHabits() {
    const list = document.getElementById("habitList");
    list.innerHTML = "";

    habits.forEach((habit, index) => {
      const li = document.createElement("li");

      const total = habit.history.length;
      const completed = habit.history.filter(h => h.done).length;
      const missed = total - completed;

      li.innerHTML = `
        <strong>${habit.name}</strong><br>
        Completed: ${completed} | Missed: ${missed}<br>
      `;

      const completeBtn = document.createElement("button");
      completeBtn.textContent = "Mark Complete";
      completeBtn.onclick = () => markHabit(index, true);

      const missBtn = document.createElement("button");
      missBtn.textContent = "Mark Missed";
      missBtn.onclick = () => markHabit(index, false);

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.onclick = () => {
        habits.splice(index, 1);
        saveHabits();
        renderHabits();
      };

      li.appendChild(completeBtn);
      li.appendChild(missBtn);
      li.appendChild(deleteBtn);

      list.appendChild(li);
    });
  }

  function addHabit() {
    const input = document.getElementById("habitInput");
    const value = input.value.trim();
    if (!value) return;

    habits.push({
      name: value,
      history: []
    });

    saveHabits();
    renderHabits();
    input.value = "";
  }

  function markHabit(index, doneStatus) {
    const today = todayString();
    const habit = habits[index];

    // Prevent double logging for same day
    const alreadyLogged = habit.history.find(h => h.date === today);
    if (alreadyLogged) {
      alert("Already logged for today.");
      return;
    }

    habit.history.push({
      date: today,
      done: doneStatus
    });

    saveHabits();
    renderHabits();
  }
    
</script>

</body>
</html>
