<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Behavioral Audit</title>
  <style>
  * {
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f4f4f4;
    color: #111;
    margin: 0;
    padding: 30px 16px;
  }

  h1 {
    font-weight: 600;
    font-size: 22px;
    margin-bottom: 20px;
  }

  /* Input row */
  .input-row {
    display: flex;
    gap: 8px;
    margin-bottom: 25px;
  }

  input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
  }

  button {
    padding: 12px;
    border: none;
    border-radius: 8px;
    background: #111;
    color: white;
    font-size: 14px;
    cursor: pointer;
  }

  button:active {
    opacity: 0.8;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li {
    background: white;
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 16px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
  }

  li strong {
    font-size: 16px;
  }

  .stats {
    font-size: 13px;
    margin: 8px 0 12px;
    color: #555;
  }

  .habit-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .habit-buttons button {
    flex: 1;
    background: #eaeaea;
    color: #111;
  }

  .habit-buttons button:first-child {
    background: #111;
    color: white;
  }

  .habit-buttons button:last-child {
    background: #dcdcdc;
  }

  @media (min-width: 600px) {
    body {
      max-width: 600px;
      margin: 60px auto;
    }
  }
</style>
</head>
<body>

  <h1>Behavioral Audit</h1>

  <div class="input-row">
  <input id="habitInput" placeholder="Enter habit">
  <button onclick="addHabit()">Add</button>
  </div>


  <ul id="habitList"></ul>

  <script>
  let habits = JSON.parse(localStorage.getItem("habits")) || [];

  function saveHabits() {
    localStorage.setItem("habits", JSON.stringify(habits));
  }

  function todayString() {
    return new Date().toISOString().split("T")[0];
  }

  function calculateStreak(history) {
  if (!history || history.length === 0) {
    return { current: 0, longest: 0 };
  }

  // Sort by date ascending
  const sorted = [...history].sort((a, b) => 
    new Date(a.date) - new Date(b.date)
  );

  let currentStreak = 0;
  let longestStreak = 0;
  let tempStreak = 0;

  for (let i = 0; i < sorted.length; i++) {
    if (sorted[i].done) {
      tempStreak++;
      longestStreak = Math.max(longestStreak, tempStreak);
    } else {
      tempStreak = 0;
    }
  }

  currentStreak = tempStreak;

  return { current: currentStreak, longest: longestStreak };
  }
    
  function renderHabits() {
  const list = document.getElementById("habitList");
  list.innerHTML = "";

  habits.forEach((habit, index) => {
    const li = document.createElement("li");

    const history = habit.history || [];
    const streak = calculateStreak(history);
    const total = history.length;
    const completed = history.filter(h => h.done).length;
    const missed = total - completed;

    li.innerHTML = `
      <strong>${habit.name}</strong>
      <div class="stats">
        Completed: ${completed} | Missed: ${missed}<br>
        Current Streak: ${streak.current} | Longest: ${streak.longest}
      </div>
    `;

    const completeBtn = document.createElement("button");
    completeBtn.textContent = "Mark Complete";
    completeBtn.onclick = () => markHabit(index, true);

    const missBtn = document.createElement("button");
    missBtn.textContent = "Mark Missed";
    missBtn.onclick = () => markHabit(index, false);

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";
    deleteBtn.onclick = () => {
      habits.splice(index, 1);
      saveHabits();
      renderHabits();
    };

    const buttonGroup = document.createElement("div");
    buttonGroup.className = "habit-buttons";

    buttonGroup.appendChild(completeBtn);
    buttonGroup.appendChild(missBtn);
    buttonGroup.appendChild(deleteBtn);

    li.appendChild(buttonGroup);

    list.appendChild(li);
    });
  }

  function addHabit() {
    const input = document.getElementById("habitInput");
    const value = input.value.trim();
    if (!value) return;

    habits.push({
      name: value,
      history: []
    });

    saveHabits();
    renderHabits();
    input.value = "";
  }

  function markHabit(index, doneStatus) {
    const today = todayString();
    const habit = habits[index];

    // Prevent double logging for same day
    const alreadyLogged = habit.history.find(h => h.date === today);
    if (alreadyLogged) {
      alert("Already logged for today.");
      return;
    }

    habit.history.push({
      date: today,
      done: doneStatus
    });

      saveHabits();
      renderHabits();
}

    renderHabits();

</script>


</body>
</html>
